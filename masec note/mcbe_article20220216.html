<!DOCTYPE html>
<html lang="ja">
<head>
  <meta property="og:site_name" content="Masec's Note" />
  <meta property="og:title" content="パーティクルだけでHPバーをつくる" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://rinca-h.github.io/masec_note/masec%20note/img/mcbe_article20220216-thumb.png" />
  <meta property="og:description" content="パーティクルだけでHPバーをつくる方法を紹介します" />
  <meta property="og:locale" content="ja_JP" />
  <meta name="twitter:card" content="summary" />
  <title>パーティクルだけでHPバーをつくる - Masec's Note</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="highlight-js/masec-light.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <!-- <pre><code class="json">//コード</code></pre> -->
  <link rel="stylesheet" type="text/css" href="basic.css">
  <link rel="stylesheet" type="text/css" href="masec_note.css">
  <link rel="stylesheet" type="text/css" href="masec_note_mokuzi.css">
  <!--<style type="text/css"></style>-->
</head>
<body>
  <div style="padding: 0.5em;"><img id="logo" src="img/masec_note_black.png"></div>
  <div style="margin: 8px;"><span class="desc">uploaded:2022/03/25</span></div>
  <div id="whole">
    <div id="main">
      <h1 id="top">MinecraftBE - パーティクルだけでHPバーをつくる</h1>
      <div style="text-align: center; margin: 0.5em;">
        <img src="img/mcbe_article20220216-thumb.png" class="ignore" width="100%">
      </div>
      <div class="announce">目次は右上の「≡」から！</div>
      <p>
        　アニメーションコントローラやエンティティのクライアントjsonと紐付けするのは各自でやってください。<br>
        　つけたいエンティティのjsonを編集して紐付けるので、すべてのエンティティにつけたい場合は手動ですべてのエンティティのjsonを編集する必要があります。<br>
        　コマンドでこのパーティクルを出そうとすると何も出ません。追加できているかどうかはパーティクル単体では確かめることはできません。<br><br>
        <b>※ 中級者以上向け</b>
      </p>
      <div id="sec01" class="headline" style="border-left: solid 10px #64ec86;">パーティクルのJSON</div><br>
      <div class="pRes">Res</div><div class="dir">particles/hp_bar.json</div>
      <pre><code class="json">{
  "format_version": "1.10.0",
  "particle_effect": {
    "description": {
      "identifier": "ex:hp_bar",
      "basic_render_parameters": {
        "material": "particles_alpha",
        "texture": "textures/particle/hp_bar"
      }
    },
    "components": {
      "minecraft:emitter_local_space": {
        "position": true,
        "rotation": true
      },
      "minecraft:particle_motion_parametric": {
        "relative_position": [ 0.0, "v.particle_height", 0.0 ]
      },
      "minecraft:emitter_rate_steady": {
        "spawn_rate": "Math.random(15, 25)",
        "max_particles": 50
      },
      "minecraft:emitter_lifetime_expression": {
        "activation_expression": 1,
        "expiration_expression": 0
      },
      "minecraft:emitter_shape_custom": {
        "offset": [ 0, 0.1, 0 ],
        "direction": [ 1.0, 0.0, 0.0 ]
      },
      "minecraft:particle_lifetime_expression": {
        "max_lifetime": 0.5
      },
      "minecraft:particle_appearance_billboard": {
        "size": [ 0.5 , 0.05 ], // 拡大率 [ 横, 縦 ]
        "facing_camera_mode": "lookat_xyz",
        "uv": {
          "texture_width": 64,
          "texture_height": 64,
          "uv": [ // (※1)
            "(1.0 - q.health / q.max_health) *32",
            "(q.health == 0) ? 36 : 30"
          ],
          "uv_size": [ 32, 4 ]
        }
      },
      "minecraft:particle_appearance_tinting": { // (※2)
        "color": [ 
          "math.min(2- 2*q.health/q.max_health, 1)",
          "math.min(2*q.health/q.max_health, 1)",
          0.0,
          1.0
        ]
      }
    }
  }
}</code></pre>
      <p>
        (※1) HPを検知してテクスチャに反映させている部分。<br>
        (※2) 白黒のテクスチャに色をつけるために必要なコンポーネント。後からこうして色をつけるためにテクスチャは白黒になっています。
      </p>
      <div id="sec02" class="headline" style="border-left: solid 10px #64ec86;">色の遷移方式の変更</div>
      <p>
        　上記のjsonの状態では、HP最大からゼロにかけて<b>緑→黄→橙となってじわじわと赤になっていく</b>遷移方式です。<br>
        　そこで、ある値を境にパッと黄、赤へと変わる遷移方式にする場合のコードを紹介します。<br>
        　上記の(※2)が指すコンポーネント内の"color"要素を次のように変更します。
      </p>
      <pre><code class="json">{
  "color": [
    "(q.health / q.max_health < 0.25) ? 1.0 : 0.0",
    "(q.health / q.max_health < 0.125) ? 0.0 : 1.0",
    0.0,
    1.0
  ]
}</code></pre>
      <p>
        　この場合、<b>HPが全体の0.25(=1/4)より小さくなった場合に黄色く、HPが全体の0.125(=1/8)より小さくなった場合に赤くなる</b>ようになっています。
        その二つの値についてはお好みで変更するといいでしょう。
      </p>
      <div id="sec02" class="headline" style="border-left: solid 10px #64ec86;">エンティティとの紐づけかた</div>
      <h3>client_entity定義ファイル</h3>
      <div class="pRes">Res</div><div class="dir">entity/〇〇.entity.json</div>
      <div class="demoCode">{
  <span class="hljs-attr">"format_version"</span>: <span class="hljs-string">"1.10.0"</span>,
  <span class="hljs-attr">"minecraft:client_entity"</span>: {
    <span class="hljs-attr">"description"</span>: {
      <span class="hljs-comment">// 省略</span>
      <span class="hljs-attr">"particle_effects"</span>: {
        <span class="hljs-attr">"</span><span style="background: #fce;">hp_bar</span><span class="hljs-attr">"</span>: <span class="hljs-string">"ex:hp_bar"</span> <span class="hljs-comment">// パーティクルのID</span>
      },
      <span class="hljs-attr">"scripts"</span>: {
        <span class="hljs-comment">// 省略</span>
        <span class="hljs-attr">"animate"</span>: [ "<span style="background: #a1ffa9;">hp_bar</span>" ]
      },
      <span class="hljs-attr">"animations"</span>: {
        <span class="hljs-attr">"</span><span style="background: #a1ffa9;">hp_bar</span><span class="hljs-attr">"</span>: <span class="hljs-string">"controller.animation.〇〇.hp_bar"</span> <span class="hljs-comment">// アニコンのID</span>
      }
    }
  }
}</div>
      <p>
        ①"particle_effects"に項目を足す<br>
        ②"animate"に今回追加するアニコンを動かすためのキーを追加する<br>
        ③"animations"にアニコンを足す<br><br>
        format_versionが1.8.0のやつは書きたくないです
      </p>
      <h3>アニコン</h3>
      <div class="pRes">Res</div><div class="dir">animation_controllers/〇〇.hp_bar.animation_controllers.json</div>
      <div class="demoCode">{
  <span class="hljs-attr">"format_version"</span>: <span class="hljs-string">"1.18.10"</span>,
  <span class="hljs-attr">"animation_controllers"</span>: {
    <span class="hljs-attr">"controller.animation.〇〇.hp_bar"</span>: {
      <span class="hljs-attr">"initial_state"</span>: <span class="hljs-string">"default"</span>,
      <span class="hljs-attr">"states"</span>: {
        <span class="hljs-attr">"default"</span>: {
          <span class="hljs-attr">"particle_effects"</span>: [
            {
              <span class="hljs-attr">"effect"</span>: <span class="hljs-string">"</span><span style="background: #fce;">hp_bar</span><span class="hljs-string">"</span>,
              <span class="hljs-attr">"pre_effect_script"</span>: <span class="hljs-string">"v.particle_height = 2.25;"</span> <span class="hljs-comment">// エンティティの高さ = 2.25</span>
            }
          ]
        }
      }
    }
  }
}</div>
      <p>
        　子どもの状態があるときは「2.25」とあるところを<b>「(q.is_baby)? 1.25 : 2.25」</b>という風にします。
      </p>
      <div id="sec03" class="headline" style="border-left: solid 10px #64ec86;">テクスチャ</div><br>
      <div class="pRes">Res</div><div class="dir">textures/particle/hp_bar.png</div><br>
      <img src="https://rinca-h.github.io/minecraft/other/img/hp_bar.png" style="width: 20vw;">
      <p>
        ※テクスチャ本体を長押しや右クリックするとダウンロードできると思います<br>
        ※ぼやけて見えますが、ダウンロードしたものはぼやけません(そのまま使えます)<br><br>
        　<b>意味があって白黒にしてあります</b>。色を塗ると色が混ざります。<br>
        　色を変えたい場合は上記のパーティクル定義jsonにある色を司る部分にて指定してください。
      </p>
      <div id="sec04" class="headline" style="border-left: solid 10px #64ec86;">(※1)の簡単な解説</div>
      <p>
        　"minecraft:particle_appearance_billboard"の"uv"ではテクスチャの切り取る部分(の基準)を指定し、"uv_size"でその切り取る大きさを指定しますが、
        今回は元のテクスチャテクスチャファイルの横が64なのに対して<b>半分の32しか切り取っていません</b>。<br>
        　下の図で赤い枠線がその「切り取る部分」です。<b>HPに応じて切り取る部分を横に動かしていけば</b>たしかにHPが減っていくように映すことができますね。
        "逆紙芝居"といったところでしょうか。<br>
        　考えたひとは頭いいと思いました。
      </p>
      <img src="https://rinca-h.github.io/minecraft/other/img/hp_bar_explanation.png"><br>
      <div id="sec05" class="headline" style="border-left: solid 10px #64ec86;">最後に</div>
      <p>
        　もっと自分なりにカスタマイズしたい場合は研究しましょう。
        カスタマイズするとしたら色の部分でしょうか？　色についてはRGBとMolangができないとキビシイかもしれません。<br>
        　ちなみに、<b>枠をつけたい場合はバーと重ならないように枠だけのパーティクルを同時に同じ場所へ表示させる</b>とできます。
      </p>
    </div>
    <div id="sidebar">
      <iframe src="side_bar.html"></iframe>
    </div>
  </div>
  <div align="right" style="margin: 8px;"><span style="font-size: 70%;">constructed by: Rinca Hayamine</span></div>
  <header>
    <div class="always-show">
      <a href="masec_note_home.html"><img id="logo" src="img/masec_note_black.png"></a>
      <div class="menu-button no-select"><label for="check"><div style="display: table-cell; vertical-align: middle;">≡</div></label></div>
    </div>
    <input type="checkbox" name="check" id="check" style="display: none;">
    <div id="move-box">
      <div class="menu-close no-select"><label for="check">×</label></div>
      <div class="content">
        <div style="display: flex;">
          <div style="display: inline-block; width: 50%;"><h2>もくじ</h2></div>
          <div style="display: inline-block; width: 50%; text-align: right; transform: translate(0em, 3em);"><a href="#top">ページのトップへ</a></div>
        </div>
        <hr style="background-color: #64ec86; border: 1px solid #64ec86;">
        <h4><a href="#sec01">パーティクルのJSON</a></h4>
        <hr style="background-color: #64ec86; border: 1px solid #64ec86;">
        <h4><a href="#sec02">色の遷移方式の変更</a></h4>
        <hr style="background-color: #64ec86; border: 1px solid #64ec86;">
        <h4><a href="#sec03">テクスチャ</a></h4>
        <hr style="background-color: #64ec86; border: 1px solid #64ec86;">
        <h4><a href="#sec04">(※1)の簡単な解説</a></h4>
        <hr style="background-color: #64ec86; border: 1px solid #64ec86;">
        <h4><a href="#sec05">最後に</a></h4>
      </div>
    </div>
  </header>
  <script src="responsive.js"></script>
</body>
</html>
